# MkDocs Simple Plugin

A plugin for MkDocs that builds a documentation website from markdown content interspersed within your code, contained in markdown files or in block comments in your source files. It also provides syntax for incorporating portions of other files into your markdown content.

To summarize its operation briefly, `simple` will search your project directory tree for documentation. By default, Markdown files and graphics files will be copied to your documentation site. In addition, source files will be searched for markdown embedded in minimally-structured comment blocks; such content will be extracted into additional markdown files included in the documentation site.

## Installation

Install the plugin with pip.

```bash
pip install mkdocs-simple-plugin
```

_Python 3.x, 3.5, 3.6, 3.7, 3.8, 3.9 supported._

### Plugin usage

Create a `mkdocs.yml` file in the root of your directory and add the `simple` plugin to its plugin list.

The example YAML below shows all of the configuration parameters for the plugin, their default values, and their meanings. Note that the parameter controlling the extraction of markdown from source files is called "semiliterate" because this facility goes partway toward providing a literate programming environment in Donald Knuth's sense: code and documentation can be interleaved, with the appropriate parts extracted by different tools. (However, this package does not provide full literate programming support, in that it does not give documentation the primary organizational role and provide tools to reorganize the code blocks into interpretable or compilable form; rather, it allows you to extract the documentation blocks and arrange them into readable form.)

```yaml
site_name: your_site_name
plugins:
  - simple:
      # Only directories whose name (final path component) matches a "glob"
      # pattern in this list will be searched for documentation:
      include_folders: ["*"]
      # In addition, directories whose name matches a glob pattern in this
      # list will NOT be searched for documentation.
      ignore_folders: []
      # Hidden directories will not be searched if this is true:
      ignore_hidden: True
      # If the following is true, the contents of the docs directory (if any)
      # will be merged at the same level as all other documentation, i.e., the
      # docs directory prefix of these files will be elided. Otherwise, the docs
      # directory will be searched like all other directories, i.e., the docs
      # directory prefix will be kept:
      merge_docs_dir: True
      # If true, the intermediate docs dir generated by simple will be kept
      # at the end of the build (mainly used for debugging this plugin):
      keep_generated_docs: False
      # Any file in the searched directories whose name contains a string in
      # this list will simply be copied to the generated documentation:
      include_extensions: [".tif", ".tiff", ".gif", ".jpeg", ".jpg", ".jif", ".jfif",
            ".jp2", ".jpx", ".j2k", ".j2c", ".fpx", ".pcd", ".png", ".pdf", "CNAME"]
      # Should standard Markdown extensions (as defined by MkDocs) be added
      # to the above list?
      include_standard_markdown: True
      # The dicts in the following list specify which other files will be
      # scanned for embedded documentation and how. The first entry in the list
      # gives all of the keys allowed in an entry, with their meanings and
      # default values. The remaining entries in the list actually constitute
      # the default value of the "semiliterate" parameter:
      semiliterate:
          # Any file in the searched directories which did not match the
          # "include_extensions" and whose name contains this
          # required regular expression parameter will be scanned:
        - pattern: None
          # By default, the extracted documentation will be copied to a file
          # whose name is generated by replacing the last matching group
          # in the "pattern" parameter with `.md`. However, if the following
          # parameter is specified, it will be expanded as a template using
          # the match object from matching "pattern" against the filename,
          # to produce the name of the extracted file:
          destination: None
          # Lines from the scanned file will be ignored until a line
          # containing this required regular expression parameter is
          # encountered. As with the other parameters ("stop" and "terminate")
          # controlling extraction, the last matching group in the "start"
          # expression, if any, will be written to the extracted file.
          # Subsequent lines, possibly with the transformations specified
          # by the "replace" parameter below, will be written to the
          # extracted file.
          start: None
          # Whenever a line containing this optional regexp is encountered,
          # copying to the extracted file will be suspended until the next
          # occurrence of "start" (if any) is encountered:
          stop: None
          # If specified, all extraction from the file is terminated when
          # a line containing this regexp is encountered. Note that if
          # "terminate" occurs before "start" nothing will be extracted
          # from the file.
          terminate: None
          # A list of regexp substitutions to be attempted on all other
          # extracted lines of the file, not matching any of the above.
          # See additional documentation for details.
          replace: []
        # Default python embedded documentation, in marked docstrings or
        # other marked triple-quoted strings:
        - pattern: '(\.py)$'
          start: '"""\smd'
          stop: '"""'
        # Default block-comment embedded documentation in other source files:
        - pattern: '(\.[^.]*)$'
          start: '/\*\*\smd'
          stop: '\*\*/'
```

To summarize, the default values for the simple plugin engender the following
behavior: All markdown and graphics files will be copied to the documentation
tree "as is." Any file with the `.py` extension will have all lines between
ones that contain `""" md` and `"""` extracted to a new corresponding `.md`
file. And any files with any other extension will have all lines between
occurrences of `/** md` and `**/` extracted to a new `.md` file.

#### Extraction with replacement

The `replace` parameter of a `semiliterate` dict allows the ordinary extracted
lines from a file to be transformed in simple ways by regular expressions.
(The "ordinary" extracted lines are all those that are copied into the
extracted file, other than the lines matching the start, stop, or terminate
patterns.) For example, this package uses `replace` to strip leading
line-comment symbols from documentation embedded in YAML files and Dockerfiles:

```yaml
{! ../mkdocs.yml {start: 'Line comment example', terminate: 'Enable inclusion'} !}
```

In more detail, the `replace` parameter is a list of substitutions to attempt.
Each substitution is specified either by a two-element list of a (Python)
regular expression and a template, or by just a regular expression. In each
line that `simple` extracts, the regular expression from each substitution in
turn is searched for.  If none match, the line is transcribed
unchanged. However, for the first one that matches, the template expanded by
the Python Match.expand function (using the succesful match object) is
transcribed in place of the line. If there is no template, then just the last
matching group is transcribed if there is one, or nothing at all is
transcribed if there is no last matching group.  This latter convention makes
it easy to selectively drop lines that contain a given regular
expression. Note that once one of the `replace` patterns matches, processing
stops; no further expressions are checked.

#### File inclusion

When `simple` is processing a file that matches a `semiliterate` pattern
(_not_ just one of the `include_extensions`) and it encounters an unescaped
expression of the form

`{! FILENAME YAML !}`

(which may span multiple lines), it performs file inclusion. The FILENAME may
be a bare word, in which case it cannot contain whitespace, or it may be
enclosed in single or double quotes. Note that FILENAME is interpreted relative
to the directory in which the file containing the `{! .. !}` expression
resides. The YAML is interpreted exactly as the extraction options to a
`semiliterate` item as documented above. The text extracted from FILENAME
is interpolated at the current location in the file currently being written.
Recursive inclusion is supported.

Note that the `{! ... !}` directive must be in lines that semiliterate would
normally copy. That is, it does not examine lines before the `start` regexp
is encountered, or after the `terminate` regexp, or between instances of
`stop` and `start`. It also doesn't check any text written from lines that
match these special expressions. Moreover, on such normally-transcribed lines,
it's the text **after** the application of the replacements as described
in the prior subsection that is checked for `{! ... !}`.

As an example, the parameters for stripping leading `#` above were interpolated
into this documentation page using the command
```
{! plugin.md {start: '(\{\!.*comment\s+.*Enable inclusion.*\!\})', stop: '```'} !}
```

Note that in order to process inclusions of this form in ordinary `.md` files,
this plugin must be extracting from them, rather than simply copying them. This
involves setting `include_standard_markdown` to false and specifying a
`semiliterate` item that processes the files, as in the following snippet
used by this package:

```yaml
{! ../mkdocs.yml {start: '(?s)^(\s*# Enable.*)$', terminate: 'ignore_folders'} !}
```

(The `replace` value above is used to remove or alter bits of the documentation
on the doc site that it is useful to have in the README on github; it would be
enough to have just the `pattern` and `start` parameters, which would extract
the entire file with no modifications -- except inclusion expressions would
be handled.)

### Build

Then, you can build the mkdocs from the command line.

```bash
mkdocs build
```

### Run a local server

One of the best parts of mkdocs is the ability to serve (and update!) your documentation site locally.

```bash
mkdocs serve
```
